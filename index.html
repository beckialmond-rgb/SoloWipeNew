<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
    <title>SoloWipe - Automate Your Window Cleaning Round | Never Chase Payments Again</title>
    <meta name="description" content="Automate your entire window cleaning round with SoloWipe. Jobs auto-reschedule, Direct Debit collects payments automatically, and SMS templates save hours. Built for UK window cleaners. Start free with 10 jobs." />
    <meta name="keywords" content="window cleaning software, window cleaner app, job management, direct debit, SMS automation, UK window cleaners, round management" />
    <meta name="author" content="SoloWipe" />
    <meta name="theme-color" content="#3b82f6" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="SoloWipe" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://solowipe.co.uk" />

    <meta property="og:title" content="SoloWipe - Automate Your Window Cleaning Round" />
    <meta property="og:description" content="Never chase payments or miss visits again. Automate jobs, payments, and customer texts in one app. Works offline. Start free with 10 jobs." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://solowipe.co.uk" />
    <meta property="og:image" content="/SoloLogo.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="SoloWipe - Automate Your Window Cleaning Round" />
    <meta name="twitter:description" content="Never chase payments or miss visits again. Start free with 10 jobs." />
    <meta name="twitter:image" content="/SoloLogo.jpg" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    
    <!-- Preload critical assets -->
    <link rel="preload" href="/SoloLogo.jpg" as="image" />
    <link rel="dns-prefetch" href="https://owqjyaiptexqwafzmcwy.supabase.co" />

    <link rel="icon" type="image/png" href="/app-icon.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/app-icon.png" />
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "SoloWipe",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Web, iOS, Android",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "GBP",
        "description": "Start free with 10 jobs, then £9.99/month",
        "availability": "https://schema.org/InStock"
      },
      "description": "Automate your window cleaning round. Jobs auto-reschedule, Direct Debit collects payments automatically, and SMS templates save hours. Built for UK window cleaners.",
      "featureList": [
        "Automated job scheduling",
        "Direct Debit payment collection",
        "SMS automation",
        "Offline-first mobile app",
        "UK GDPR compliant",
        "Route optimization",
        "Real-time earnings tracking"
      ],
      "screenshot": "https://solowipe.co.uk/SoloLogo.jpg",
      "author": {
        "@type": "Organization",
        "name": "SoloWipe",
        "url": "https://solowipe.co.uk"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Do I have to use Direct Debit?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. You can still take cash or bank transfer and mark jobs as paid manually. Direct Debit is there to automate collections for customers who prefer it."
          }
        },
        {
          "@type": "Question",
          "name": "What if my signal is bad or I work in rural areas?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "SoloWipe is built to work offline. You can view jobs, complete work, and add customers without internet—everything syncs automatically when you are back online."
          }
        },
        {
          "@type": "Question",
          "name": "Is SoloWipe only for UK window cleaners?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. SoloWipe is designed specifically for UK window cleaners with GBP pricing, UK tax assumptions, and GoCardless Direct Debit integration."
          }
        },
        {
          "@type": "Question",
          "name": "How hard is it to switch from my paper diary or Excel?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Most users can move their round across in an evening. Start with your most regular streets, add customers with price and frequency, and SoloWipe will handle the rest."
          }
        },
        {
          "@type": "Question",
          "name": "What happens after my first 10 free jobs?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "You can keep all your data. To continue automating new jobs and SMS, you can subscribe to Pro and get a 7-day free trial with full access."
          }
        },
        {
          "@type": "Question",
          "name": "Can I cancel anytime?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. You can cancel your subscription at any time from within the app. There are no contracts and no cancellation phone calls."
          }
        }
      ]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "SoloWipe",
      "url": "https://solowipe.co.uk",
      "logo": "https://solowipe.co.uk/SoloLogo.jpg",
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "Customer Service",
        "areaServed": "GB",
        "availableLanguage": "English"
      },
      "sameAs": []
    }
    </script>
  </head>

  <body>
    <div id="root">
      <!-- Fallback content if JavaScript fails to load -->
      <noscript>
        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; text-align: center; font-family: system-ui, -apple-system, sans-serif;">
          <div>
            <h1>JavaScript Required</h1>
            <p>Please enable JavaScript to use this application.</p>
          </div>
        </div>
      </noscript>
      <!-- Loading state while app initializes -->
      <div id="loading-fallback" style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; text-align: center; font-family: system-ui, -apple-system, sans-serif;">
        <div>
          <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007AFF; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
          <p>Loading SoloWipe...</p>
        </div>
      </div>
      <style>
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        #root:not(:empty) #loading-fallback { display: none; }
      </style>
    </div>
    <script>
      // Pre-load diagnostics - run before module loads
      console.log('[Pre-Load] Starting app initialization...');
      console.log('[Pre-Load] User agent:', navigator.userAgent);
      console.log('[Pre-Load] Online:', navigator.onLine);
      console.log('[Pre-Load] URL:', window.location.href);
      console.log('[Pre-Load] Protocol:', window.location.protocol);
      console.log('[Pre-Load] Host:', window.location.host);
      
      // Check if we're in production
      const isProduction = window.location.hostname !== 'localhost' && 
                          window.location.hostname !== '127.0.0.1' &&
                          !window.location.hostname.includes('localhost');
      console.log('[Pre-Load] Production mode:', isProduction);
      
      // Track module loading
      let moduleLoadStarted = false;
      let moduleLoadError = null;
      
      // Monitor script loading (works for both dev and production)
      const scripts = document.getElementsByTagName('script');
      for (let i = 0; i < scripts.length; i++) {
        const script = scripts[i];
        // Check for module scripts (both .tsx in dev and .js in production)
        if (script.type === 'module' && (script.src.includes('main') || script.src.includes('index'))) {
          script.addEventListener('load', function() {
            console.log('[Pre-Load] Module script loaded successfully:', script.src);
            moduleLoadStarted = true;
          });
          script.addEventListener('error', function(e) {
            console.error('[Pre-Load] Module script failed to load:', script.src, e);
            moduleLoadError = e;
            showErrorScreen('Failed to load application files. Please check your connection and try again.');
          });
        }
      }
      
      // Also check for dynamically loaded scripts
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          mutation.addedNodes.forEach(function(node) {
            if (node.nodeName === 'SCRIPT' && node.type === 'module') {
              const script = node as HTMLScriptElement;
              if (script.src && (script.src.includes('main') || script.src.includes('index'))) {
                script.addEventListener('load', function() {
                  console.log('[Pre-Load] Dynamically loaded module:', script.src);
                  moduleLoadStarted = true;
                });
                script.addEventListener('error', function(e) {
                  console.error('[Pre-Load] Dynamic module failed:', script.src, e);
                  moduleLoadError = e;
                });
              }
            }
          });
        });
      });
      observer.observe(document.head, { childList: true, subtree: true });
      
      // Fallback: if module doesn't start loading within 5 seconds
      setTimeout(function() {
        if (!moduleLoadStarted && !moduleLoadError) {
          console.error('[Pre-Load] Module did not start loading within 5 seconds');
          const root = document.getElementById('root');
          if (root && !root.querySelector('.error-display') && !window.__SOLOWIPE_REACT_MOUNTED__) {
            showErrorScreen('Application files are taking too long to load. Please check your connection.');
          }
        }
      }, 5000);
      
      // Helper function (defined early)
      function showErrorScreen(message) {
        const root = document.getElementById('root');
        if (!root) return;
        if (root.querySelector('.error-display')) return;
        if (window.__SOLOWIPE_REACT_MOUNTED__) return;
        
        root.innerHTML = '<div class="error-display" style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; text-align: center; font-family: system-ui, -apple-system, sans-serif; background: #f5f5f5;"><div style="max-width: 500px; background: white; padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"><h1 style="margin: 0 0 12px 0; font-size: 20px; color: #1a1a1a;">Application Error</h1><p style="margin: 0 0 16px 0; color: #666; font-size: 14px;">' + (message || 'An error occurred loading the application.') + '</p><p style="font-size: 12px; color: #999; margin: 16px 0 0 0;">Check the browser console (F12) for details.</p><button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #007AFF; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">Reload Page</button></div></div>';
      }
    </script>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      let errorCount = 0;
      const MAX_ERRORS_BEFORE_SHOWING = 3;
      const MOUNT_TIMEOUT = 15000; // 15 seconds
      
      // Initialize React mount tracking
      window.__SOLOWIPE_REACT_MOUNTED__ = false;
      window.__SOLOWIPE_REACT_MOUNTING__ = false;
      
      // Hide loading fallback once React mounts
      function checkReactMount() {
        const rootElement = document.getElementById('root');
        const isMounted = window.__SOLOWIPE_REACT_MOUNTED__ || 
                         (rootElement && rootElement.children.length > 0 && !rootElement.querySelector('.error-display'));
        
        if (isMounted) {
          const fallback = document.getElementById('loading-fallback');
          if (fallback) fallback.style.display = 'none';
          return true;
        }
        return false;
      }
      
      // Check periodically if React has mounted
      const mountCheckInterval = setInterval(function() {
        if (checkReactMount()) {
          clearInterval(mountCheckInterval);
        }
      }, 200);
      
      // Timeout: if React hasn't mounted after timeout, show error
      setTimeout(function() {
        clearInterval(mountCheckInterval);
        if (!checkReactMount()) {
          const rootElement = document.getElementById('root');
          if (rootElement && !rootElement.querySelector('.error-display')) {
            console.error('[App] React failed to mount within ' + MOUNT_TIMEOUT + 'ms');
            showErrorScreen('Application failed to load. Please check your connection and try again.');
          }
        }
      }, MOUNT_TIMEOUT);
      
      // Helper to show error screen (only if React hasn't mounted)
      function showErrorScreen(message) {
        const root = document.getElementById('root');
        if (!root) return;
        
        // Don't show if React has mounted (let ErrorBoundary handle it)
        if (window.__SOLOWIPE_REACT_MOUNTED__ || checkReactMount()) {
          console.log('[App] React is mounted, letting ErrorBoundary handle error');
          return;
        }
        
        // Don't show if error display already exists
        if (root.querySelector('.error-display')) {
          return;
        }
        
        root.innerHTML = '<div class="error-display" style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; text-align: center; font-family: system-ui, -apple-system, sans-serif;"><div><h1>Application Error</h1><p>' + (message || 'An error occurred loading the application. Please refresh the page.') + '</p><p style="font-size: 12px; color: #666; margin-top: 10px;">Check the browser console for details.</p><button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #007AFF; color: white; border: none; border-radius: 6px; cursor: pointer;">Reload Page</button></div></div>';
      }
      
      // Check if error is critical (should show error screen)
      function isCriticalError(error, filename) {
        // Ignore resource loading errors (images, fonts, etc.)
        if (filename && (
          filename.includes('.png') ||
          filename.includes('.jpg') ||
          filename.includes('.jpeg') ||
          filename.includes('.gif') ||
          filename.includes('.svg') ||
          filename.includes('.woff') ||
          filename.includes('.woff2') ||
          filename.includes('.ttf') ||
          filename.includes('.eot') ||
          filename.includes('favicon')
        )) {
          return false;
        }
        
        // Ignore CORS errors for external resources (unless it's a critical script)
        if (error && error.message && (
          error.message.includes('CORS') ||
          error.message.includes('Failed to fetch') ||
          error.message.includes('NetworkError')
        )) {
          // Only ignore if it's not a critical script
          if (filename && !filename.includes('main.tsx') && !filename.includes('App.tsx') && !filename.includes('main.js')) {
            return false;
          }
        }
        
        // Critical errors: JavaScript errors in app code
        if (filename && (
          filename.includes('main.tsx') ||
          filename.includes('main.js') ||
          filename.includes('App.tsx') ||
          filename.includes('App.js') ||
          (filename.includes('.js') && !filename.includes('node_modules')) ||
          (filename.includes('.tsx') && !filename.includes('node_modules')) ||
          (filename.includes('.ts') && !filename.includes('node_modules'))
        )) {
          return true;
        }
        
        // If error has a stack trace and is not a resource error, it's likely critical
        if (error && error.stack && !error.message?.includes('favicon')) {
          return true;
        }
        
        return false;
      }
      
      // Global error handler for uncaught errors
      window.addEventListener('error', function(e) {
        // Enhanced mobile error logging
        const deviceInfo = {
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          language: navigator.language,
          screenSize: window.screen.width + 'x' + window.screen.height,
          viewportSize: window.innerWidth + 'x' + window.innerHeight,
          online: navigator.onLine,
          cookieEnabled: navigator.cookieEnabled,
          url: window.location.href,
          timestamp: new Date().toISOString(),
        };
        
        console.error('[Global Error Handler] Uncaught error:', e.error);
        console.error('[Global Error Handler] Error message:', e.message);
        console.error('[Global Error Handler] Error filename:', e.filename);
        console.error('[Global Error Handler] Error line:', e.lineno);
        console.error('[Global Error Handler] Error column:', e.colno);
        console.error('[Global Error Handler] Device info:', deviceInfo);
        
        if (e.error && e.error.stack) {
          console.error('[Global Error Handler] Error stack:', e.error.stack);
        }
        
        // Only show error screen for critical errors
        if (isCriticalError(e.error, e.filename)) {
          errorCount++;
          console.warn('[Global Error Handler] Critical error detected (' + errorCount + '/' + MAX_ERRORS_BEFORE_SHOWING + ')');
          
          // Only show error screen after multiple critical errors or if React hasn't mounted
          if (errorCount >= MAX_ERRORS_BEFORE_SHOWING || !window.__SOLOWIPE_REACT_MOUNTED__) {
            showErrorScreen('A critical error occurred. Please refresh the page.');
          }
        } else {
          console.log('[Global Error Handler] Non-critical error ignored:', e.message);
        }
      });
      
      // Handle unhandled promise rejections
      window.addEventListener('unhandledrejection', function(e) {
        const deviceInfo = {
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          url: window.location.href,
          timestamp: new Date().toISOString(),
        };
        
        console.error('[Global Error Handler] Unhandled promise rejection:', e.reason);
        console.error('[Global Error Handler] Device info:', deviceInfo);
        
        if (e.reason && e.reason.stack) {
          console.error('[Global Error Handler] Rejection stack:', e.reason.stack);
        }
        
        // Only show error for critical promise rejections
        const reason = e.reason;
        const reasonMessage = reason?.message || String(reason || '');
        
        // Ignore network errors and non-critical rejections
        if (reasonMessage.includes('Failed to fetch') || 
            reasonMessage.includes('NetworkError') ||
            reasonMessage.includes('CORS') ||
            reasonMessage.includes('ChunkLoadError')) {
          console.log('[Global Error Handler] Non-critical promise rejection ignored');
          return;
        }
        
        // For other rejections, increment error count only if React hasn't mounted
        if (!window.__SOLOWIPE_REACT_MOUNTED__) {
          errorCount++;
          if (errorCount >= MAX_ERRORS_BEFORE_SHOWING) {
            showErrorScreen('An error occurred. Please refresh the page.');
          }
        }
      });
    </script>
  </body>
</html>
